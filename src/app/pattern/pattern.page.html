<ion-header class="header-with-shadow">
  <ion-toolbar>
    <ion-title class="ion-text-start fw-bold">
      <span class="text-dark">Animations</span>
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
  <div class="pattern-list-container">
    <ion-searchbar
      class="pattern-search"
      placeholder="Search patterns..."
      debounce="250"
      mode="ios"
      [(ngModel)]="searchText">
    </ion-searchbar>

    <ion-segment [value]="sortOption" (ionChange)="onSortChange($event.detail.value)" class="pattern-sort">
      <ion-segment-button value="name">
        <ion-label>Sort: Name</ion-label>
      </ion-segment-button>
      <ion-segment-button value="duration">
        <ion-label>Duration</ion-label>
      </ion-segment-button>
    </ion-segment>

    <ion-item lines="none" class="fav-toggle-item">
      <ion-label>Favorites only</ion-label>
      <ion-toggle slot="end" (ionChange)="onFavToggle($event)"></ion-toggle>
    </ion-item>

    <ion-list lines="none" class="pattern-list">
      <ion-item *ngFor="let pattern of sortedFilteredPatterns" class="pattern-item" (click)="selectPattern(pattern)" detail="false">
        <div class="item-content">
          <div class="lead-badge" (click)="$event.stopPropagation(); selectPattern(pattern)">
            <ion-icon [name]="currentPattern?.name === pattern.name ? 'stop' : 'play'"></ion-icon>
          </div>
          <div class="text-info">
            <div class="name">{{ pattern.name }}</div>
            <div class="duration">Duration: {{ pattern.duration }}</div>
          </div>
        </div>
        <div slot="end" class="end-side">
          <ion-button fill="clear" class="fav-button" [class.fav-active]="isFavorite(pattern)" (click)="$event.stopPropagation(); toggleFavorite(pattern)">
            <ion-icon [name]="isFavorite(pattern) ? 'star' : 'star-outline'" slot="icon-only"></ion-icon>
          </ion-button>
          <div class="status-dot" [class.active]="currentPattern?.name === pattern.name"></div>
        </div>
      </ion-item>
    </ion-list>
  </div>

  <div class="now-playing-panel" *ngIf="currentPattern">
    <div class="now-playing-text">
      <div class="label">NOW PLAYING</div>
      <div class="name">{{ currentPattern.name }}</div>
    </div>
    <ion-icon name="square" class="stop-icon" (click)="currentPattern = null"></ion-icon>
  </div>

  <!-- Bottom Tab Bar -->
  <div class="bottom-tab-bar">
    <ion-row>
      <ion-col class="ion-text-center">
        <ion-button 
          color="medium" 
          fill="clear" 
          expand="block" 
          routerLink="/home" 
          routerDirection="back"
          class="tab-button">
          <ion-icon name="bulb-outline"></ion-icon>
          <ion-label>Control</ion-label>
        </ion-button>
      </ion-col>
      <ion-col class="ion-text-center">
        <ion-button 
          color="warning" 
          fill="clear" 
          expand="block" 
          class="tab-button tab-button-active">
          <ion-icon name="play-circle"></ion-icon>
          <ion-label>Patterns</ion-label>
        </ion-button>
      </ion-col>
      <ion-col class="ion-text-center">
        <ion-button 
          color="medium" 
          fill="clear" 
          expand="block" 
          routerLink="/settings" 
          routerDirection="forward"
          class="tab-button">
          <ion-icon name="settings-outline"></ion-icon>
          <ion-label>System</ion-label>
        </ion-button>
      </ion-col>
    </ion-row>
  </div>
</ion-content>