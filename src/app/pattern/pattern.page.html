<ion-header class="header-with-shadow">
  <ion-toolbar>
    <ion-title class="ion-text-start fw-bold">
      <span class="">Animations</span>
    </ion-title>
    <ion-buttons slot="end">
      <ion-button routerLink="/learning" class="learning-button">
        <ion-icon name="school-outline" slot="icon-only"></ion-icon>
      </ion-button>
      <ion-button routerLink="/profile" class="profile-button">
        <ion-icon name="person-circle-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
  <div class="page-pattern">
  <div class="pattern-list-container">
    <ion-searchbar
      class="pattern-search"
      placeholder="Search patterns..."
      debounce="250"
      mode="ios"
      [(ngModel)]="searchText">
    </ion-searchbar>

    <ion-segment [value]="sortOption" (ionChange)="onSortChange($event.detail.value)" class="pattern-sort">
      <ion-segment-button value="name">
        <ion-label>Sort: Name</ion-label>
      </ion-segment-button>
      <ion-segment-button value="duration">
        <ion-label>Duration</ion-label>
      </ion-segment-button>
    </ion-segment>

    <ion-item lines="none" class="fav-toggle-item">
      <ion-label>Favorites only</ion-label>
      <ion-toggle slot="end" (ionChange)="onFavToggle($event)"></ion-toggle>
    </ion-item>

    <ion-list lines="none" class="pattern-list">
      <ion-item *ngFor="let pattern of sortedFilteredPatterns" class="pattern-item" (click)="selectPattern(pattern)" detail="false">
        <div class="item-content">
          <div class="lead-badge" (click)="$event.stopPropagation(); selectPattern(pattern)">
            <ion-icon [name]="currentPattern?.id === pattern.id ? 'stop' : 'play'"></ion-icon>
          </div>
          <div class="text-info">
            <div class="name">{{ pattern.name }}</div>
            <div class="duration">Duration: {{ pattern.duration }}</div>
          </div>
        </div>
        <div slot="end" class="end-side">
          <ion-button fill="clear" class="fav-button" [class.fav-active]="isFavorite(pattern)" (click)="$event.stopPropagation(); toggleFavorite(pattern)">
            <ion-icon [name]="isFavorite(pattern) ? 'star' : 'star-outline'" slot="icon-only"></ion-icon>
          </ion-button>
          <div class="status-dot" [class.active]="currentPattern?.id === pattern.id"></div>
        </div>
      </ion-item>
    </ion-list>
  </div>

  <div class="now-playing-panel" *ngIf="currentPattern">
    <div class="now-playing-text">
      <div class="label">NOW PLAYING</div>
      <div class="name">{{ currentPattern.name }}</div>
    </div>
    <ion-icon name="square" class="stop-icon" (click)="selectPattern(currentPattern)"></ion-icon>
  </div>

  </div><!-- /.page-pattern -->
</ion-content>

<!-- Footer Navigation -->
<ion-footer>
  <ion-tab-bar slot="bottom" class="custom-tab-bar">

    <!-- Control = /home -->
    <ion-tab-button tab="home" routerLink="/home">
      <ion-icon name="bulb-outline"></ion-icon>
      <ion-label>Control</ion-label>
    </ion-tab-button>

    <!-- Patterns = /pattern -->
    <ion-tab-button tab="pattern" routerLink="/pattern" class="active-tab">
      <div class="tab-active-bg">
        <ion-icon name="play-outline"></ion-icon>
        <ion-label>Patterns</ion-label>
      </div>
    </ion-tab-button>

    <!-- Learning = /learning -->
    <ion-tab-button tab="learning" routerLink="/learning">
      <ion-icon name="school-outline"></ion-icon>
      <ion-label>Learning</ion-label>
    </ion-tab-button>

    <!-- System = /settings -->
    <ion-tab-button tab="settings" routerLink="/settings">
      <ion-icon name="settings-outline"></ion-icon>
      <ion-label>System</ion-label>
    </ion-tab-button>

  </ion-tab-bar>
</ion-footer>